(this["webpackJsonprequest-generator"]=this["webpackJsonprequest-generator"]||[]).push([[0],{163:function(e,t,n){},210:function(e,t,n){"use strict";(function(e){var s=n(11),a=n(0),r=n(211),i=n(51),o=n.n(i),c=n(223),l=n(224),d=n(221),u=n.n(d),p=n(375),h=n(374),f=n(103),b=n(23),g=n.n(b),m=n(1),j=function(){var t=Object(r.a)(),n=Object(a.useState)(null),i=Object(s.a)(n,2),d=i[0],b=i[1],j=Object(a.useState)(null),v=Object(s.a)(j,2),x=v[0],O=v[1],y=Object(a.useState)(null),S=Object(s.a)(y,2),k=S[0],C=S[1];Object(a.useEffect)((function(){if(d){var t=JSON.parse(e.from(d.split(".")[1],"base64")),n=o.a.client({serverUrl:g.a.get("REACT_APP_EHR_BASE").asString(),tokenResponse:{type:"bearer",access_token:d,patient:t.patientId}});n.request("Patient/".concat(n.patient.id)).then((function(e){C(R(e))})),O(n)}}),[d]);var R=function(e){var t=[];return e.name&&(e.name[0].given&&t.push(e.name[0].given[0]),e.name[0].family&&t.push(e.name[0].family)),t.join(" ")};return Object(m.jsxs)("div",{className:t.background,children:[Object(m.jsx)(p.a,{position:"fixed",sx:{zIndex:1300,backgroundColor:"#bb3551",height:"95px"},children:Object(m.jsxs)(h.a,{children:[Object(m.jsxs)(f.a,{variant:"h5",noWrap:!0,component:"div",sx:{lineHeight:"95px"},children:[Object(m.jsx)("strong",{children:"EHR"})," Patient Portal"]}),k?Object(m.jsxs)("span",{className:t.loginIcon,children:[Object(m.jsx)(u.a,{sx:{fontSize:60,verticalAlign:"middle"}})," ",k]}):null]})}),d&&x?Object(m.jsx)(l.a,{client:x}):Object(m.jsx)(c.a,{tokenCallback:b})]})};t.a=Object(a.memo)(j)}).call(this,n(146).Buffer)},211:function(e,t,n){"use strict";var s=n(371);t.a=Object(s.a)((function(e){return{background:{backgroundColor:e.palette.common.offWhite,height:"100vh"},adminBar:{height:"95px",backgroundColor:e.palette.common.redDark,width:"100%",textAlign:"center",lineHeight:"95px"},adminBarText:{color:e.palette.common.white,fontSize:"19px",fontFamily:"Verdana",float:"left",marginLeft:"20px"},formFont:{fontFamily:'"Gill Sans", sans-serif'},loginIcon:{color:e.palette.common.white,fontSize:"19px",marginLeft:"auto",fontFamily:"Verdana",float:"right",marginRight:"20px",verticalAlign:"middle"}}}),{name:"PatientPortal",index:1})},223:function(e,t,n){"use strict";var s=n(11),a=n(0),r=n(454),i=n(462),o=n(448),c=n(447),l=n(1);var d=function(e){var t=e.message,n=e.handleClose;return Object(l.jsx)(o.a,{open:null!==t,autoHideDuration:6e3,onClose:n,anchorOrigin:{vertical:"top",horizontal:"center"},children:Object(l.jsx)(c.a,{onClose:n,severity:"error",children:t})})},u=n(78),p=n.n(u),h=n(371),f=Object(h.a)((function(e){return{background:{backgroundColor:e.palette.common.offWhite,height:"100vh",overflow:"hidden"},formFont:{fontFamily:'"Gill Sans", sans-serif'},loginButton:{width:"460px",marginTop:"20px !important",height:"90px",color:e.palette.common.white,backgroundColor:"".concat(e.palette.common.red," !important"),fontSize:"30px !important",textTransform:"none !important",fontFamily:"inherit",fontWeight:"200 !important"},loginContent:{width:"600px",height:"700px",boxShadow:"0 4px 4px rgba(0, 0, 0, 0.10)",backgroundColor:e.palette.common.white,margin:"150px auto 0px auto",paddingLeft:"75px",paddingTop:"90px",textAlign:"left"},loginHeader:{fontSize:"36px",fontWeight:600,width:"100%",color:e.palette.common.grayDark,fontFamily:"inherit"},loginInput:{display:"block",fontFamily:"inherit"},loginPersistance:{display:"flex",lineHeight:"144px"},loginCheckbox:{height:"24px",width:"24px",margin:"60px 0px 15px 0px"},loginCheckboxText:{fontWeight:100,fontSize:"24px",marginLeft:"20px",color:e.palette.common.grayLightText,fontFamily:"inherit"},loginSubheader:{fontSize:"24px",textAlign:"left",fontWeight:100,color:e.palette.common.grayLightText,marginTop:"20px",fontFamily:"inherit"},passwordField:{marginBottom:"30px"},passwordForget:{float:"right",color:e.palette.common.red,margin:"10px 70px 0px 0px",fontSize:"24px",fontFamily:"inherit",cursor:"pointer"},resize:{display:"block",marginTop:"30px !important",marginBottom:"5px !important",fontSize:"20px",fontWeight:100,color:e.palette.common.black,width:"450px"}}}),{name:"Auth",index:1}),b=n(23),g=n.n(b),m=function(e){var t=f(),n=Object(a.useState)(null),o=Object(s.a)(n,2),c=o[0],u=o[1],h=Object(a.useState)(""),b=Object(s.a)(h,2),m=b[0],j=b[1],v=Object(a.useState)(""),x=Object(s.a)(v,2),O=x[0],y=x[1],S=Object(a.useCallback)((function(){if(m&&O){var t=new URLSearchParams;t.append("username",m),t.append("password",O),t.append("grant_type","password"),t.append("client_id",g.a.get("REACT_APP_CLIENT").asString()),p.a.post("".concat(g.a.get("REACT_APP_AUTH").asString(),"/realms/").concat(g.a.get("REACT_APP_REALM").asString(),"/protocol/openid-connect/token"),t,{withCredentials:!0}).then((function(t){e.tokenCallback(t.data.access_token)})).catch((function(e){u("Unable to Login"),console.error(e)}))}}),[m,O,e]);Object(a.useEffect)((function(){var e=function(e){"Enter"!==e.code&&"NumpadEnter"!==e.code||(e.preventDefault(),S())};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[m,O,S]);return Object(l.jsxs)("div",{className:t.background,children:[Object(l.jsx)(d,{message:c,handleClose:function(){return u(null)}}),Object(l.jsxs)("div",{className:"".concat(t.loginContent," ").concat(t.formFont),children:[Object(l.jsx)("div",{className:t.loginHeader,children:"Log in."}),Object(l.jsx)("div",{className:t.loginSubheader,children:"Log in to view your patient records."}),Object(l.jsxs)("form",{noValidate:!0,autoComplete:"off",className:t.formFont,children:[Object(l.jsx)(r.a,{classes:{root:t.resize},variant:"standard",value:m,onChange:function(e){j(e.target.value)},label:"Username"}),Object(l.jsx)(r.a,{classes:{root:t.resize},variant:"standard",type:"password",label:"Password",value:O,onChange:function(e){y(e.target.value)}}),Object(l.jsx)(i.a,{variant:"contained",classes:{root:t.loginButton,label:t.formFont},onClick:S,children:"Log In"}),Object(l.jsx)("div",{className:t.passwordForget,children:"Forgot password?"})]})]})]})};t.a=Object(a.memo)(m)},224:function(e,t,n){"use strict";var s=n(3),a=n(14),r=n(11),i=n(0),o=n(371),c=Object(o.a)((function(e){return{adminBar:{height:"95px",backgroundColor:e.palette.common.purple,width:"100%",textAlign:"center",lineHeight:"95px"},formFont:{fontFamily:'"Gill Sans", sans-serif'},dashboardArea:{backgroundColor:"#fdfdfd",margin:"80px 60px 0px 60px",padding:"20px",overflowY:"auto",overflowX:"hidden",height:"75vh"},dashboardElement:{height:"100px",width:"100%",padding:"10px",margin:"5px",fontSize:"18px",cursor:"pointer","&:hover":{boxShadow:"0px 2px 1px 1px rgb(0 0 0 / 40%), 0px 1px 1px 0px rgb(0 0 0 / 28%), 0px 1px 3px 0px rgb(0 0 0 / 24%)"}},elementHeader:{marginLeft:"5px",display:"inline-block"},elementIcon:{verticalAlign:"middle"},listItemText:{fontSize:"4.2em"},progressBubble:{height:"12px",width:"12px",borderRadius:"12px",float:"right"},spacer:{}}}),{name:"Dashboard",index:1}),l=n(69),d=(n(32),n(456)),u=n(213),p=n.n(u),h=n(119),f=n.n(h),b=n(23),g=n.n(b),m=n(1),j=function(e){var t,n=c(),s=e.resource,a=e.client.state,i=e.status,o=new Date(s.meta.lastUpdated).toUTCString(),u=s.questionnaire.split("/").slice(-1),h=Object(r.a)(u,1)[0];return Object(m.jsx)("div",{onClick:function(){var e={appContext:encodeURIComponent("response=QuestionnaireResponse/".concat(s.id)),type:"smart",url:g.a.get("REACT_APP_LAUNCH_URL").asString()};Object(l.a)(e,a.tokenResponse.accessToken,a.tokenResponse.patient,a.serverUrl,"r4").then((function(e){window.open(e.url,"_blank")}))},children:Object(m.jsxs)(d.a,{className:n.dashboardElement,children:[function(){var e={};return"in-progress"===i?e={backgroundColor:"#fdbe14"}:"completed"===i&&(e={backgroundColor:"#20c997"}),Object(m.jsx)("div",{style:e,className:n.progressBubble})}(),Object(m.jsxs)("div",{children:[Object(m.jsx)(p.a,{className:n.elementIcon})," ",Object(m.jsx)("strong",{children:"Last Updated"}),": ",Object(m.jsxs)("span",{children:[" ",o]})]}),Object(m.jsxs)("div",{children:[Object(m.jsx)(f.a,{className:n.elementIcon})," ",Object(m.jsx)("strong",{children:" Questionnaire"}),": ",(t=h,t.split(/([A-Z][a-z]+)/).filter((function(e){return e}))).join(" ")]})]})})},v=Object(i.memo)(j),x=n(449),O=n(446),y=n(459),S=n(455),k=n(438),C=n(374),R=n(460),E=n(442),P=n(217),w=n.n(P),A=n(218),T=n.n(A),N=n(220),L=n.n(N),U=n(451),q=n(439),D=n(440),I=n(441),_=n(214),M=n.n(_),B=n(215),F=n.n(B),H=n(219),W=n.n(H),Q=n(216),V=n.n(Q),z=function(e){var t=c(),n=Object(i.useState)([]),o=Object(r.a)(n,2),l=o[0],u=o[1],p=Object(i.useState)("Loading..."),h=Object(r.a)(p,2),b=h[0],g=h[1],j=Object(i.useState)(!0),P=Object(r.a)(j,2),A=P[0],N=P[1],_="340px",B=function(e){e.entry&&e.entry.forEach((function(e){var t=e.resource;u((function(e){return[].concat(Object(a.a)(e),[t])}))}))};Object(i.useEffect)((function(){e.client.patient.id?e.client.patient.request("QuestionnaireResponse",{pageLimit:0,onPage:B}).then((function(){g("No QuestionnaireResponses Found for user with patientId: "+e.client.patient.id)})):g("Invalid patient: No patientId provided")}),[e.client.patient]);return Object(m.jsx)("div",{children:Object(m.jsxs)(y.a,{sx:{display:"flex"},children:[Object(m.jsx)(k.a,{}),Object(m.jsx)("div",{className:t.spacer}),Object(m.jsxs)(S.a,{variant:"permanent",sx:Object(s.a)({width:_,flexShrink:0},"& .MuiDrawer-paper",{width:_,boxSizing:"border-box"}),children:[Object(m.jsx)(C.a,{}),Object(m.jsx)(y.a,{sx:{overflow:"auto",marginTop:"31px"},children:Object(m.jsx)(R.a,{children:function(){var e=[],t={fontSize:"40px"},n={height:"80px"};return e.push(["Notifications",Object(m.jsx)(M.a,{sx:t}),n]),e.push(["Appointments",Object(m.jsx)(F.a,{sx:t}),n]),e.push(["Questionnaire Forms",Object(m.jsx)(f.a,{sx:t}),{height:"80px",backgroundColor:"#f5f5fa"}]),e.push(["Health Data",Object(m.jsx)(V.a,{sx:t}),n]),e.push(["Medications",Object(m.jsx)(w.a,{sx:t}),n]),e.push(["Tests and Results",Object(m.jsx)(T.a,{sx:t}),n]),e.push(["Settings",Object(m.jsx)(W.a,{sx:t}),n]),e.push(["Logout",Object(m.jsx)(L.a,{sx:t}),n]),e}().map((function(e){return Object(m.jsxs)("div",{children:[Object(m.jsx)(U.a,{style:e[2],disablePadding:!0,children:Object(m.jsxs)(q.a,{children:[Object(m.jsx)(D.a,{children:e[1]}),Object(m.jsx)(I.a,{primaryTypographyProps:{fontSize:"18px"},primary:e[0]})]})},e[0]),Object(m.jsx)(E.a,{})]})}))})})]}),Object(m.jsxs)(y.a,{component:"main",sx:{flexGrow:1,p:3},children:[Object(m.jsx)(C.a,{}),Object(m.jsxs)("div",{className:t.dashboardArea,children:[Object(m.jsx)("h2",{className:t.elementHeader,children:"Available Forms"}),Object(m.jsx)(x.a,{style:{float:"right"},control:Object(m.jsx)(O.a,{checked:A,onChange:function(e){N(e.target.checked)}}),label:"Only show in-progress forms"}),l.length>0?function(){var e=[];return(e=A?l.filter((function(e){return"in-progress"===e.status})):l).reverse(),e}().map((function(t){return Object(m.jsx)(v,{status:t.status,resource:t,client:e.client},t.id)})):Object(m.jsx)(d.a,{className:t.dashboardElement,children:b})]})]})]})})};t.a=Object(i.memo)(z)},308:function(e,t,n){},32:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return a}));var s={alternativeTherapy:{display:"Alternative Therapy Cards Allowed",type:"check"},baseUrl:{display:"Base Server",type:"input"},cdsUrl:{display:"REMS Admin",type:"input"},defaultUser:{display:"Default User",type:"input"},ehrUrl:{display:"EHR Server",type:"input"},includeConfig:{display:"Include Configuration in CRD Request",type:"check"},launchUrl:{display:"DTR Launch URL (QuestionnaireForm)",type:"input"},orderSelect:{display:"Order Select Rest End Point",type:"input"},orderSign:{display:"Order Sign Rest End Point",type:"input"},patientView:{display:"Patient View Rest End Point",type:"input"},pimsUrl:{display:"PIMS Server",type:"input"},responseExpirationDays:{display:"In Progress Form Expiration Days",type:"input"},sendPrefetch:{display:"Send Prefetch",type:"check"},smartAppUrl:{display:"SMART App",type:"input"}},a={error:"errorClass",info:"infoClass",debug:"debugClass",warning:"warningClass"},r=[{key:"CPAP",text:"E0601",value:"E0601",codeSystem:"https://bluebutton.cms.gov/resources/codesystem/hcpcs"},{key:"Wheelchair",text:"97542",value:"97542",codeSystem:"http://www.ama-assn.org/go/cpt"},{key:"Crutches",text:"E0110",value:"E0110",codeSystem:"https://bluebutton.cms.gov/resources/codesystem/hcpcs"},{key:"Hospital Bed",text:"E0250",value:"E0250",codeSystem:"https://bluebutton.cms.gov/resources/codesystem/hcpcs"},{key:"Continuous Glucose Monitoring",text:"95250",value:"95250",codeSystem:"http://www.ama-assn.org/go/cpt"},{key:"Nebulizer",text:"94640",value:"94640",codeSystem:"http://www.ama-assn.org/go/cpt"},{key:"Glucose Test Strip",text:"82947",value:"82947",codeSystem:"http://www.ama-assn.org/go/cpt"},{key:"Oxygen Therapy",text:"E0424",value:"E0424",codeSystem:"https://bluebutton.cms.gov/resources/codesystem/hcpcs"}],i={"http://www.ama-assn.org/go/cpt":"CPT","https://bluebutton.cms.gov/resources/codesystem/hcpcs":"HCPCS","http://www.nlm.nih.gov/research/umls/rxnorm":"RxNorm","http://hl7.org/fhir/sid/ndc":"NDC"}},325:function(e,t,n){},335:function(e,t,n){},336:function(e,t,n){},337:function(e,t,n){},340:function(e,t,n){},365:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),r=n(52),i=n.n(r),o=(n(163),n(19)),c=n(20),l=n(25),d=n(26),u=n(120),p=n(13),h=n(14),f=n(3),b=n(18),g=n(51),m=n.n(g),j=(n(308),n(462)),v=n(463),x=n(464),O=n(103),y=n(465),S=n(5),k=n.n(S),C=n(78),R=n.n(C),E=n(443),P=n(204),w=n.n(P),A=n(69),T=(n(325),n(1)),N=(k.a.bool,k.a.object,k.a.func.isRequired,k.a.string,k.a.string,k.a.string,k.a.object,function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).launchLink=s.launchLink.bind(Object(b.a)(s)),s.launchSource=s.launchSource.bind(Object(b.a)(s)),s.renderSource=s.renderSource.bind(Object(b.a)(s)),s.modifySmartLaunchUrls=s.modifySmartLaunchUrls.bind(Object(b.a)(s)),s.exitSmart=s.exitSmart.bind(Object(b.a)(s)),s.state={value:"",smartLink:"",response:{}},s}return Object(c.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return JSON.stringify(e.response)!==JSON.stringify(this.state.response)||this.state.smartLink!==t.smartLink}},{key:"supportedRequesType",value:function(e){var t=e.resourceType.toUpperCase();if("DEVICEREQUEST"===t||"SERVICEREQUEST"===t||"MEDICATIONREQUEST"===t||"MEDICATIONDISPENSE"===t)return!0}},{key:"takeSuggestion",value:function(e,t,n,s,a,r){var i=this;if(!this.props.isDemoCard){if("at-most-one"===r)for(var o=0;o<s;o++){var c="suggestion_button-"+a+"-"+o;document.getElementById(c).setAttribute("disabled","true")}else document.getElementById(n).setAttribute("disabled","true");if(e.label){e.uuid&&R()({method:"POST",url:"".concat(t,"/analytics/").concat(e.uuid),data:{}});var l=m.a.client({serverUrl:this.props.ehrUrl,tokenResponse:{access_token:this.props.access_token.access_token}}),d="";e.actions.forEach((function(e){"DELETE"===e.type.toUpperCase()?(d=e.resource.resourceType+"/"+e.resource.id,console.log("completing suggested action DELETE: "+d),l.delete(d).then((function(e){console.log("suggested action DELETE result:"),console.log(e)}))):"CREATE"===e.type.toUpperCase()?(d=e.resource.resourceType,console.log("completing suggested action CREATE: "+d),l.create(e.resource).then((function(e){console.log("suggested action CREATE result:"),console.log(e),i.supportedRequesType(e)&&i.props.takeSuggestion(e)}))):"UPDATE"===e.type.toUpperCase()?(d=e.resource.resourceType+"/"+e.resource.id,console.log("completing suggested action UPDATE: "+d),l.update(e.resource).then((function(e){console.log("suggested action UPDATE result:"),console.log(e)}))):console.log("WARNING: unknown action")}))}else console.error("There was no label on this suggestion",e)}}},{key:"launchSource",value:function(e,t){e.preventDefault(),window.open(t.url,"_blank")}},{key:"exitSmart",value:function(e){this.setState({smartLink:""})}},{key:"launchLink",value:function(e,t){if(!this.props.isDemoCard){if(e.preventDefault(),t.error)return;window.open(t.url,"_blank")}}},{key:"modifySmartLaunchUrls",value:function(e){var t=this;if(!this.props.isDemoCard)return e.links.map((function(e){var n=Object.assign({},e);return"smart"!==e.type||!t.props.fhirAccessToken&&!t.props.ehrLaunch||t.state.smartLink?"smart"===e.type&&(e.url.indexOf("?")<0?n.url+="?":n.url+="&"):Object(A.a)(n,t.props.fhirAccessToken,t.props.patientId,t.props.fhirServerUrl,t.props.fhirVersion).then((function(e){return n=e})),n}))}},{key:"renderSource",value:function(e){var t,n=this;return e.label?(e.icon&&(t=Object(T.jsx)("img",{className:"card-icon",src:e.icon,alt:"Could not fetch icon",width:"100",height:"100"})),this.props.isDemoCard?Object(T.jsxs)("div",{className:"card-source",children:["Source:",Object(T.jsx)("a",{className:"source-link",href:"#",onClick:function(t){return n.launchSource(t,e)},children:e.label}),t]}):Object(T.jsxs)("div",{className:"card-source",children:["Source: ",Object(T.jsx)("a",{className:"source-link",href:e.url||"#",onClick:function(t){return n.launchSource(t,e)},children:e.label}),t]})):null}},{key:"render",value:function(){var e=this;this.buttonList=[];var t={info:0,warning:1,"hard-stop":2,error:3},n=[];return null!=this.state.response&&null!=this.state.response.cards?(this.state.response.cards.sort((function(e,n){return t[n.indicator]-t[e.indicator]})).forEach((function(t,s){var r,i=JSON.parse(JSON.stringify(t)),o=Object(T.jsx)("p",{children:i.summary}),c=i.source&&Object.keys(i.source).length?e.renderSource(i.source):"",l=i.detail?Object(T.jsx)("div",{children:Object(T.jsx)(E.a,{source:i.detail})}):Object(T.jsx)("p",{style:{color:"grey"},children:"None"}),d=[];i.suggestions&&i.suggestions.forEach((function(t,n){var a="suggestion_button-"+s+"-"+n;e.buttonList.push(a),d.push(Object(T.jsx)(j.a,{onClick:function(){return e.takeSuggestion(t,i.serviceUrl,a,i.suggestions.length,s,i.selectionBehavior)},variant:"contained",id:a,children:t.label},n))})),i.links&&(i.links=e.modifySmartLaunchUrls(i)||i.links,r=i.links.map((function(t,n){if("smart"===t.type)return Object(T.jsx)(j.a,{variant:"outlined",onClick:function(n){return e.launchLink(n,t)},children:t.label},n);var s=Object(T.jsx)(w.a,{});return Object(T.jsx)(j.a,{onClick:function(n){return e.launchLink(n,t)},endIcon:s,children:t.label},n)})));var u={marginBottom:"2px",color:"black"},p=Object(T.jsx)(v.a,{variant:"outlined",className:"decision-card alert-info",children:Object(T.jsxs)(a.a.Fragment,{children:[Object(T.jsxs)(x.a,{children:[Object(T.jsx)(O.a,{style:u,gutterBottom:!0,children:"Summary"}),Object(T.jsx)(O.a,{variant:"h5",component:"div",children:o}),Object(T.jsx)("br",{}),Object(T.jsx)(O.a,{style:u,gutterBottom:!0,children:"Details"}),Object(T.jsx)(O.a,{variant:"div",children:l}),Object(T.jsx)("br",{}),Object(T.jsx)(O.a,{variant:"div",gutterBottom:!0,children:c})]}),Object(T.jsx)(y.a,{className:"links-section",children:r})]})},s);n.push(p)})),0===n.length?Object(T.jsxs)("div",{children:["Notification Cards (",n.length,")"]}):Object(T.jsxs)("div",{children:["Notification Cards (",n.length,")",Object(T.jsx)("div",{children:n})]})):Object(T.jsx)("div",{})}},{key:"componentDidUpdate",value:function(){console.log(this.buttonList),this.buttonList.forEach((function(e,t){document.getElementById(e).removeAttribute("disabled")}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return JSON.stringify(e.response)!==JSON.stringify(t.response)?{response:e.response}:null}}]),n}(s.Component)),L=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).handleAddition=function(e,t){var n=t.value;s.setState({options:[{text:n,value:n}].concat(Object(h.a)(s.state.options))})},s.handleChange=function(e,t){var n=t.value;s.props.updateCB(s.props.elementName,n),s.setState({currentValue:n})},s.state={showStatus:"hideConsole",headerStatus:"collapseHeader"},s.toggleConsole=s.toggleConsole.bind(Object(b.a)(s)),s}return Object(c.a)(n,[{key:"toggleConsole",value:function(){"showConsole"===this.state.showStatus?(this.setState({showStatus:"hideConsole"}),this.setState({headerStatus:"collapseHeader"})):(this.setState({showStatus:"showConsole"}),this.setState({headerStatus:"showHeader"}))}},{key:"render",value:function(){try{var e=document.getElementById("your_div");e.scrollTop=e.scrollHeight}catch(n){}var t=0;return Object(T.jsxs)("div",{children:[Object(T.jsx)(j.a,{variant:"outlined",className:this.state.headerStatus+" consoleHeader",onClick:this.toggleConsole,children:"showConsole"===this.state.showStatus?"Close console":"Open Developer console"}),Object(T.jsx)("div",{id:"your_div",className:this.state.showStatus+" consoleMain resize",children:this.props.logs.map((function(e){return t++,Object(T.jsxs)("div",{children:[" ",Object(T.jsx)("span",{className:e.type,children:e.content})]},t)}))})]})}}]),n}(s.Component),U=(n(335),n(29)),q=(n(336),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).onInputChange=s.onInputChange.bind(Object(b.a)(s)),s}return Object(c.a)(n,[{key:"onInputChange",value:function(e){this.props.updateCB(this.props.elementName,e.target.value)}},{key:"render",value:function(){return Object(T.jsx)("div",{children:Object(T.jsx)("input",{className:"form-control input-text "+this.props.extraClass,name:this.props.elementName,value:this.props.value,onChange:this.onInputChange})})}}]),n}(s.Component)),D=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).onInputChange=s.onInputChange.bind(Object(b.a)(s)),s}return Object(c.a)(n,[{key:"onInputChange",value:function(e){this.props.updateCB(this.props.elementName,!this.props.toggle)}},{key:"render",value:function(){var e=this.props.toggle?"checkBoxClicked":"checkBox",t=this.props.toggle?"onOffActive":"onOff";return Object(T.jsx)("span",{children:Object(T.jsxs)("button",{className:e+" btn-class btn "+this.props.extraClass,name:this.props.elementName,onClick:this.onInputChange,children:[this.props.displayName," ",Object(T.jsx)("span",{className:t+" onOffState "+this.props.extraInnerClass})]})})}}]),n}(s.Component),I=n(32),_=[{display:"Clear EHR QuestionnaireResponses",key:"clearQuestionnaireResponses",reset:function(e,t){var n=e.ehrUrl,s=e.defaultUser,a=e.access_token;return function(e){console.log("Clear QuestionnaireResponses from the EHR: "+n+" for author "+s);var r=m.a.client(Object(U.a)({serverUrl:n},a?{tokenResponse:a}:{}));r.request("QuestionnaireResponse?author="+s,{flat:!0}).then((function(e){console.log(e),e.forEach((function(e){console.log(e.id),r.delete("QuestionnaireResponse/"+e.id).then((function(n){t("Successfully deleted QuestionnaireResponse "+e.id+" from EHR",I.d.info),console.log(n)})).catch((function(t){console.log("Failed to delete QuestionnaireResponse "+e.id),console.log(t)}))}))})).catch((function(e){console.log("Failed to retrieve list of QuestionnaireResponses"),console.log(e)}))}}},{display:"Reset PIMS Database",key:"resetPims",reset:function(e,t){var n=e.pimsUrl;return function(e){var s=new URL(n).origin+"/doctorOrders/api/deleteAll";console.log("reset pims: "+s),fetch(s,{method:"DELETE"}).then((function(e){console.log("Reset pims: "),console.log(e),t("Successfully reset pims database",I.d.info)})).catch((function(e){console.log("Reset pims error: "),t("Server returned error when resetting pims: ",I.d.error),t(e.message),console.log(e)}))}}},{display:"Reset REMS-Admin Database",key:"resetRemsAdmin",reset:function(e,t){var n=e.cdsUrl;return function(e){var s=new URL(n).origin+"/etasu/reset";fetch(s,{method:"POST"}).then((function(e){console.log("Reset rems admin etasu: "),console.log(e),t("Successfully reset rems admin etasu",I.d.info)})).catch((function(e){console.log("Reset rems admin error: "),t("Server returned error when resetting rems admin etasu: ",I.d.error),t(e.message),console.log(e)}))}}}],M=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.state,n=e.consoleLog,s=e.updateCB,a=Object.keys(I.b).map((function(e){return Object(U.a)(Object(U.a)({},I.b[e]),{},{key:e})})).sort((function(e,t){return-e.type.localeCompare(t.type)||e.display.localeCompare(t.display)}));return Object(T.jsxs)("div",{children:[a.map((function(e){var n=e.key,a=e.type,r=e.display;switch(a){case"input":return Object(T.jsxs)("div",{children:[Object(T.jsx)("p",{className:"setting-header",children:r}),Object(T.jsx)(q,{extraClass:"setting-input",value:t[n],updateCB:s,elementName:n})]},n);case"check":return Object(T.jsxs)("div",{children:[Object(T.jsxs)("p",{className:"setting-header",children:[r,Object(T.jsx)(D,{extraClass:"setting-checkbox",extraInnerClass:"setting-inner-checkbox",toggle:t[n],updateCB:s,elementName:n})]}),Object(T.jsx)("p",{children:"\xa0"})]},n);default:return Object(T.jsx)("div",{children:Object(T.jsx)("p",{className:"setting-header",children:r})},n)}})),_.map((function(e){var s=e.key,a=e.display,r=e.reset;return Object(T.jsx)("div",{children:Object(T.jsx)("button",{className:"setting-btn btn btn-class",onClick:r(t,n),children:a})},s)}))]})}}]),n}(s.Component);function B(e){var t=new Date,n=new Date(e),s=t.getFullYear()-n.getFullYear(),a=t.getMonth()-n.getMonth();return(a<0||0===a&&t.getDate()<n.getDate())&&s--,s}n(337);var F=n(470),H=n(208),W=n.n(H),Q=n(459),V=n(453),z=n(469),J=n(466),G=n(444),K=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).state={request:"",deviceRequests:{},medicationRequests:{},serviceRequests:{},medicationDispenses:{},response:"",questionnaireResponses:{},openRequests:!1,openQuestionnaires:!1},s.handleRequestChange=s.handleRequestChange.bind(Object(b.a)(s)),s.updatePrefetchRequest=s.updatePrefetchRequest.bind(Object(b.a)(s)),s.getDeviceRequest=s.getDeviceRequest.bind(Object(b.a)(s)),s.getServiceRequest=s.getServiceRequest.bind(Object(b.a)(s)),s.getMedicationRequest=s.getMedicationRequest.bind(Object(b.a)(s)),s.getMedicationDispense=s.getMedicationDispense.bind(Object(b.a)(s)),s.getRequests=s.getRequests.bind(Object(b.a)(s)),s.getResponses=s.getResponses.bind(Object(b.a)(s)),s.makeQROption=s.makeQROption.bind(Object(b.a)(s)),s.handleResponseChange=s.handleResponseChange.bind(Object(b.a)(s)),s.makeDropdown=s.makeDropdown.bind(Object(b.a)(s)),s}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.getRequests(),this.getResponses()}},{key:"getCoding",value:function(e){var t=null;return"DeviceRequest"===e.resourceType?t=e.codeCodeableConcept.coding[0]:"ServiceRequest"===e.resourceType?t=e.code.coding[0]:"MedicationRequest"!==e.resourceType&&"MedicationDispense"!==e.resourceType||(t=e.medicationCodeableConcept.coding[0]),t?(t.code||(t.code="Unknown"),t.display||(t.display="Unknown"),t.system||(t.system="Unknown")):(t.code="Unknown",t.display="Unknown",t.system="Unknown"),t}},{key:"makeDropdown",value:function(e,t,n,s){return console.log(e),Object(T.jsx)(Q.a,{sx:{minWidth:120},children:Object(T.jsxs)(J.a,{fullWidth:!0,children:[Object(T.jsx)(V.a,{children:t}),Object(T.jsx)(G.a,{labelId:"".concat(t,"-label"),value:n,label:t,"data-testid":"dropdown-box",onChange:s,children:e.map((function(e){return Object(T.jsx)(z.a,{value:e.value,children:e.text},e.key)}))})]})})}},{key:"makeOption",value:function(e,t){var n=this.getCoding(e),s={key:e.id,text:n.display+" (Medication request: "+n.code+")",value:JSON.stringify(e)};t.push(s)}},{key:"updateValues",value:function(e){if(this.props.callback("patient",e),this.props.callback("openPatient",!1),this.props.clearCallback(),this.state.request){var t=JSON.parse(this.state.request);"DeviceRequest"===t.resourceType||"ServiceRequest"===t.resourceType||"MedicationRequest"===t.resourceType||"MedicationDispense"===t.resourceType?this.updatePrefetchRequest(t,e,this.props.defaultUser):this.props.clearCallback()}else this.updatePrefetchRequest(null,e,this.props.defaultUser);if(this.state.response){var n=JSON.parse(this.state.response);this.updateQRResponse(e,n)}}},{key:"updateQRResponse",value:function(e,t){this.props.callback("response",t)}},{key:"fetchResources",value:function(e){var t=this;console.log(e);var n=[];this.props.callback("prefetchCompleted",!1),e.forEach((function(e,s){var a=t.props.ehrUrl+"/"+e;n.push(fetch(a,{method:"GET"}).then((function(e){return e.json()})).then((function(e){t.props.callbackMap("prefetchedResources",s,e)})))})),Promise.all(n).then((function(e){console.log("fetchResourcesSync: finished"),t.props.callback("prefetchCompleted",!0)})).catch((function(e){console.log("fetchResourcesSync: failed to wait for all the prefetch to populate"),console.log(e)}))}},{key:"updatePrefetchRequest",value:function(e,t,n){var s="Patient/"+(null===t||void 0===t?void 0:t.id),a="Practitioner/"+n;if(e){this.props.callback(e.resourceType,e);var r=this.props.updatePrefetchCallback(e,s,a,"request","patient","practitioner");this.fetchResources(r),this.props.callback("request",e);var i=this.getCoding(e);this.props.callback("code",i.code),this.props.callback("codeSystem",i.system),this.props.callback("display",i.display)}else{r=this.props.updatePrefetchCallback(e,s,a,"patient","practitioner","medicationRequests");this.fetchResources(r)}}},{key:"getDeviceRequest",value:function(e,t){var n=this;t.request("DeviceRequest?subject=Patient/".concat(e),{resolveReferences:["subject","performer"],graph:!1,flat:!0}).then((function(e){n.setState({deviceRequests:e})}))}},{key:"getServiceRequest",value:function(e,t){var n=this;t.request("ServiceRequest?subject=Patient/".concat(e),{resolveReferences:["subject","performer"],graph:!1,flat:!0}).then((function(e){n.setState({serviceRequests:e})}))}},{key:"getMedicationRequest",value:function(e,t){var n=this;t.request("MedicationRequest?subject=Patient/".concat(e),{resolveReferences:["subject","performer"],graph:!1,flat:!0}).then((function(e){n.setState({medicationRequests:e})}))}},{key:"getMedicationDispense",value:function(e,t){var n=this;t.request("MedicationDispense?subject=Patient/".concat(e),{resolveReferences:["subject","performer"],graph:!1,flat:!0}).then((function(e){n.setState({medicationDispenses:e})}))}},{key:"handleRequestChange",value:function(e){var t=e.target.value;if(t){var n=this.getCoding(JSON.parse(t));this.setState({request:t,code:n.code,system:n.system,display:n.display,response:""})}else this.setState({request:""})}},{key:"handleResponseChange",value:function(e){var t=e.target.value;t?this.setState({response:t}):this.setState({response:""})}},{key:"getRequests",value:function(){var e=m.a.client(this.props.params),t=this.props.patient.id;this.getDeviceRequest(t,e),this.getServiceRequest(t,e),this.getMedicationRequest(t,e),this.getMedicationDispense(t,e)}},{key:"getResponses",value:function(){var e=this,t=m.a.client(this.props.params),n=this.props.patient.id,s=new Date;s.setDate(s.getDate()-this.props.responseExpirationDays),t.request("QuestionnaireResponse?_lastUpdated=gt".concat(s.toISOString().split("T")[0],"&status=in-progress&subject=Patient/").concat(n),{resolveReferences:["subject"],graph:!1,flat:!0}).then((function(t){e.setState({questionnaireResponses:t})}))}},{key:"makeQROption",value:function(e,t){var n="".concat(e.questionnaire,": created at ").concat(e.authored),s={key:e.id,text:n,value:JSON.stringify(e)};t.push(s)}},{key:"render",value:function(){var e=this,t=this.props.patient,n="";t.name&&(n=Object(T.jsxs)("span",{children:[" ","".concat(t.name[0].given[0]," ").concat(t.name[0].family)," "]}));var s=[],a=[],r=!1;this.state.deviceRequests.data&&(r=!0,this.state.deviceRequests.data.forEach((function(t){e.makeOption(t,s)}))),this.state.serviceRequests.data&&(r=!0,this.state.serviceRequests.data.forEach((function(t){e.makeOption(t,s)}))),this.state.medicationRequests.data&&(r=!0,this.state.medicationRequests.data.forEach((function(t){e.makeOption(t,s)}))),this.state.medicationDispenses.data&&(r=!0,this.state.medicationDispenses.data.forEach((function(t){e.makeOption(t,s)}))),this.state.questionnaireResponses.data&&(this.state.questionnaireResponses.data.forEach((function(t){return e.makeQROption(t,a)})),r=!0);return r||"Loading...",Object(T.jsxs)("div",{className:"patient-box",children:[Object(T.jsxs)("div",{className:"patient-header",children:[Object(T.jsx)("span",{style:{fontWeight:"bolder"},children:n||"N/A"})," ","(ID: ".concat(t.id,")")]}),Object(T.jsxs)("div",{className:"patient-selection-box",children:[Object(T.jsxs)("div",{className:"patient-info",children:[Object(T.jsxs)("div",{children:[Object(T.jsx)("span",{style:{fontWeight:"bold"},children:"Gender"}),":"," ",t.gender]}),Object(T.jsxs)("div",{children:[Object(T.jsx)("span",{style:{fontWeight:"bold"},children:"Age"}),":"," ",B(t.birthDate)]})]}),Object(T.jsxs)("div",{className:"request-info",children:[Object(T.jsx)("span",{style:{fontWeight:"bold",marginRight:"5px",padding:"5px"},children:"Request:"}),!s.length&&r?Object(T.jsx)("span",{className:"emptyForm",children:"No requests"}):this.makeDropdown(s,"Choose a patient",this.state.request,this.handleRequestChange)]}),Object(T.jsxs)("div",{className:"request-info",children:[Object(T.jsxs)("span",{style:{fontWeight:"bold",marginRight:"5px",padding:"5px"},children:["In Progress Form:",Object(T.jsx)(F.a,{color:"primary",style:{padding:"0px 5px"},onClick:this.getResponses,children:Object(T.jsx)(W.a,{})})]}),!a.length&&r?Object(T.jsx)("span",{className:"emptyForm",children:"No in progress forms"}):this.makeDropdown(a,"Choose an in-progress form",this.state.response,this.handleResponseChange)]}),Object(T.jsx)(j.a,{variant:"outlined",size:"small",className:"select-btn",onClick:function(){return e.updateValues(t)},children:"Select"})]})]},t.id)}}]),n}(s.Component);function Y(e,t,n,s){var a=e.createElement(n),r=e.createTextNode(s);a.appendChild(r),t.appendChild(a)}function X(e,t){var n=e.createElement("Name");return Y(e,n,"LastName",t.family),Y(e,n,"FirstName",t.given[0]),n}function Z(e,t){var n=e.createElement("Address");return Y(e,n,"AddressLine1",t.line[0]),Y(e,n,"City",t.city),Y(e,n,"StateProvince",t.state),Y(e,n,"PostalCode",t.postalCode),Y(e,n,"Country","US"),n}function $(e,t,n){var s=document.implementation.createDocument("","",null),a=s.createElement("Message"),r=s.createElement("Header");Y(s,r,"MessageID",(new Date).getTime()),a.appendChild(r);var i=s.createElement("Body"),o=s.createElement("NewRx");return o.appendChild(function(e,t){var n=e.createElement("Patient"),s=e.createElement("HumanPatient"),a=t.name[0];s.appendChild(X(e,a));var r="U",i=t.gender.toLowerCase();"male"===i?r="M":"female"===i?r="F":"other"===i&&(r="N"),Y(e,s,"Gender",r);var o=e.createElement("DateOfBirth");Y(e,o,"Date",t.birthDate),s.appendChild(o);var c=t.address[0];return s.appendChild(Z(e,c)),n.appendChild(s),n}(s,e)),o.appendChild(function(e,t){for(var n=e.createElement("Prescriber"),s=e.createElement("NonVeterinarian"),a=0;a<t.identifier.length;a++){var r=t.identifier[a];if(r.system&&r.system.includes("us-npi")){var i=e.createElement("Identification");Y(e,i,"NPI",r.value),s.appendChild(i)}}var o=t.name[0];s.appendChild(X(e,o));var c=t.address[0];s.appendChild(Z(e,c));for(var l=e.createElement("CommunicationNumbers"),d=0;d<t.telecom.length;d++){var u=t.telecom[d];if("phone"===u.system){var p=e.createElement("PrimaryTelephone");Y(e,p,"Number",u.value),l.appendChild(p)}else"email"===u.system&&Y(e,l,"ElectronicMail",u.value)}return s.appendChild(l),n.appendChild(s),n}(s,t)),o.appendChild(function(e,t){for(var n=e.createElement("MedicationPrescribed"),s=e.createElement("DrugCoded"),a=t.medicationCodeableConcept.coding,r=0;r<a.length;r++){var i=a[r],o=i.system.toLowerCase();if(o.endsWith("rxnorm"))Y(e,n,"DrugDescription",i.display);else if(o.endsWith("ndc")){var c=e.createElement("ProductCode");Y(e,c,"Code",i.code),Y(e,c,"Qualifier","ND"),s.appendChild(c)}}n.appendChild(s);var l=t.dispenseRequest,d=e.createElement("Quantity");Y(e,d,"Value",l.quantity.value),Y(e,d,"CodeListQualifier",38);var u=e.createElement("QuantityUnitOfMeasure");Y(e,u,"Code",function(e){if(e.quantity.system.toLowerCase().endsWith("v3-orderableDrugForm".toLowerCase()))switch(e.quantity.code.toUpperCase()){case"APPFUL":case"FOAMAPL":case"VAGFOAMAPL":case"VAGCRMAPL":case"OINTAPL":case"VAGOINTAPL":case"GELAPL":case"VGELAPL":return"C62412";case"CAPLET":return"C64696";case"CAP":return"C48480";case"GUM":return"C69124";case"ORTROCHE":return"C48506";case"PAD":case"MEDPAD":return"C65032";case"PATCH":case"TPATCH":case"TPATH16":case"TPATH24":case"TPATH2WK":case"TPATH72":case"TPATHWK":return"C48524";case"SUPP":case"RECSUPP":case"URETHSUPP":case"VAGSUPP":return"C48539";case"SWAB":case"MEDSWAB":return"C53504";case"TAB":case"ORTAB":case"BUCTAB":case"SRBUCTAB":case"CHEWTAB":case"CPTAB":case"DISINTTAB":case"DRTAB":case"ECTAB":case"ERECTTAB":case"ERTAB":case"ERTAB12":case"ERTAB24":case"SLTAB":case"VAGTAB":return"C48542";case"WAFER":return"C48552";default:return"C38046"}return"C38046"}(l)),d.appendChild(u),n.appendChild(d);var p=e.createElement("WrittenDate");Y(e,p,"Date",t.authoredOn),n.appendChild(p),Y(e,n,"Substitutions",0),Y(e,n,"NumberOfRefills",l.numberOfRepeatsAllowed);var h=e.createElement("Sig");return Y(e,h,"SigText",t.dosageInstruction[0].text),n.appendChild(h),Y(e,n,"PrescriberCheckedREMS","B"),n}(s,n)),i.appendChild(o),a.appendChild(i),s.appendChild(a),s}var ee=n(155),te=n.n(ee),ne=(n(340),function(){function e(t){Object(o.a)(this,e),this.query=t}return Object(c.a)(e,[{key:"getQuery",value:function(){return this.query}}],[{key:"generatePrefetchMap",value:function(){var t=new Map,n=new e("{{context.userId}}"),s=new e("MedicationRequest/{{context.medications.MedicationRequest.id}}"),a=new e("{{context.patientId}}"),r=new e("MedicationRequest?subject={{context.patientId}}");return t.set("request",s),t.set("practitioner",n),t.set("patient",a),t.set("medicationRequests",r),t}},{key:"generateParamElementMap",value:function(){var e=new Map;return e.set("context.userId",["requester","reference"]),e.set("context.draftOrders.DeviceRequest.id",["id"]),e.set("context.medications.MedicationRequest.id",["id"]),e.set("context.medications.MedicationDispense.id",["id"]),e.set("context.draftOrders.NutritionOrder.id",["id"]),e.set("context.draftOrders.ServiceRequest.id",["id"]),e.set("context.draftOrders.ontext.appointments.Appointment.id",["id"]),e.set("context.draftOrders.context.encounterId",["id"]),e.set("context.patientId",["subject","reference"]),e}},{key:"generateQueries",value:function(t,n,s){for(var a=new Map,r=0;r<(arguments.length<=3?0:arguments.length-3);r++){for(var i=r+3<3||arguments.length<=r+3?void 0:arguments[r+3],o=se.get(i).getQuery(),c=o.match(/(?<=\{\{)[\s\S]*?(?=\}\})/g),l=o.slice(),d=0;d<c.length;d++){var u=c[d];if(t)var p=e.resolveParameter(u,t);else"context.patientId"===u?p=n:"context.userId"===u&&(p=s);l=l.replace("{{"+u+"}}",p)}a.set(i,l)}return a}},{key:"getProp",value:function(t,n){if(1===n.length)return t[n[0]];if(0===n.length)throw new Error("Invalid property.");return t[n[0]]||(t[n[0]]={}),e.getProp(t[n[0]],n.slice(1))}},{key:"resolveParameter",value:function(t,n){var s=ae.get(t);return e.getProp(n,s)}}]),e}()),se=ne.generatePrefetchMap(),ae=ne.generateParamElementMap(),re=n(209),ie=n.n(re),oe=n(445),ce=n(458),le={position:"absolute",top:"50%",left:"50%",flexDirection:"column",width:"80%",transform:"translate(-50%, -50%)",display:"flex",bgcolor:"background.paper",border:"2px solid #000",borderBottom:"2px solid black",boxShadow:24,p:4,padding:"0px"},de=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).exitSmart=function(){s.setState({openPatient:!1})},s.submitPatientView=function(){s.props.submitInfo(s.prepPrefetch(),null,s.state.patient,"patient-view")},s.submitOrderSelect=function(){te.a.isEmpty(s.state.request)||s.props.submitInfo(s.prepPrefetch(),s.state.request,s.state.patient,"order-select")},s.submitOrderSign=function(e){s.props.submitInfo(s.prepPrefetch(),e,s.state.patient,"order-sign")},s.submit=function(){te.a.isEmpty(s.state.request)||s.submitOrderSign(s.state.request)},s.updateStateElement=function(e,t){s.setState(Object(f.a)({},e,t))},s.updateStateList=function(e,t){s.setState((function(n){return Object(f.a)({},e,[].concat(Object(h.a)(n[e]),[t]))}))},s.updateStateMap=function(e,t,n){s.setState((function(s){return s[e][t]||(s[e][t]=[]),Object(f.a)({},e,Object(U.a)(Object(U.a)({},s[e]),{},Object(f.a)({},t,n)))}))},s.clearState=function(){s.setState({prefetchedResources:new Map,practitioner:{},coverage:{},response:{}})},s.getPatients=function(){s.setState({openPatient:!0});var e={serverUrl:s.props.ehrUrl};s.props.access_token.access_token&&(e.tokenResponse={access_token:s.props.access_token.access_token}),m.a.client(e).request("Patient?_sort=identifier&_count=12",{flat:!0}).then((function(e){s.setState({patientList:e})})).catch((function(e){s.setState({patientList:e})}))},s.emptyField=Object(T.jsx)("span",{className:"empty-field",children:"empty"}),s.launchSmartOnFhirApp=function(){var e,t;console.log("Launch SMART on FHIR App");var n=null===(e=s.state.prefetchedResources)||void 0===e||null===(t=e.practitioner)||void 0===t?void 0:t.id;n||(console.log("Practitioner not populated from prefetch, using default from config: "+s.props.defaultUser),n=s.props.defaultUser);var a={appContext:"user="+n+"&patient="+s.state.patient.id,type:"smart",url:s.props.smartAppUrl};Object(A.a)(a,s.props.fhirAccessToken,s.state.patient.id,s.props.fhirServerUrl,s.props.fhirVersion).then((function(e){a=e,console.log(a),window.open(a.url,"_blank")}))},s.relaunch=function(e){s.buildLaunchLink().then((function(e){window.open(e.url,"_blank")}))},s.sendRx=function(e){console.log("sendRx: "+s.props.pimsUrl);var t=$(s.state.prefetchedResources.patient,s.state.prefetchedResources.practitioner,s.state.request);console.log(t);var n=new XMLSerializer;s.props.consoleLog("Sending Rx to PIMS",I.d.info),fetch(s.props.pimsUrl,{method:"POST",headers:{Accept:"application/xml","Content-Type":"application/xml"},body:n.serializeToString(t)}).then((function(e){console.log("sendRx response: "),console.log(e),s.props.consoleLog("Successfully sent Rx to PIMS",I.d.info)})).catch((function(e){console.log("sendRx error: "),s.props.consoleLog("Server returned error sending Rx to PIMS: ",I.d.error),s.props.consoleLog(e.message),console.log(e)}))},s.state={openPatient:!1,patientList:[],patient:{},prefetchedResources:new Map,codeValues:I.a,code:null,codeSystem:null,display:null,request:{},gatherCount:0,response:{}},s.renderRequestResources=s.renderRequestResources.bind(Object(b.a)(s)),s.renderPatientInfo=s.renderPatientInfo.bind(Object(b.a)(s)),s.renderOtherInfo=s.renderOtherInfo.bind(Object(b.a)(s)),s.renderResource=s.renderResource.bind(Object(b.a)(s)),s.renderPrefetchedResources=s.renderPrefetchedResources.bind(Object(b.a)(s)),s.renderError=s.renderError.bind(Object(b.a)(s)),s.buildLaunchLink=s.buildLaunchLink.bind(Object(b.a)(s)),s}return Object(c.a)(n,[{key:"replaceRequestAndSubmit",value:function(e){this.setState({request:e}),this.submitOrderSign(e)}},{key:"componentDidMount",value:function(){}},{key:"prepPrefetch",value:function(){var e=this,t=new Map;return Object.keys(this.state.prefetchedResources).forEach((function(n){var s=[];s=Array.isArray(e.state.prefetchedResources[n])?e.state.prefetchedResources[n].map((function(e){return e})):e.state.prefetchedResources[n],t.set(n,s)})),t}},{key:"componentDidUpdate",value:function(e,t){t.prefetchCompleted!=this.state.prefetchCompleted&&this.state.prefetchCompleted&&this.state.prefetchedResources.medicationRequests&&this.submitPatientView()}},{key:"renderPatientInfo",value:function(){var e,t=this.state.patient;return 0===Object.keys(t).length?Object(T.jsx)("div",{className:"demographics"}):(e=t.name?Object(T.jsxs)("span",{children:[" ","".concat(t.name[0].given[0]," ").concat(t.name[0].family)," "]}):this.emptyField,Object(T.jsxs)("div",{className:"demographics",children:[Object(T.jsx)("div",{className:"lower-border",children:Object(T.jsx)("span",{style:{fontWeight:"bold"},children:"Demographics"})}),Object(T.jsxs)("div",{className:"info lower-border",children:["Name: ",e]}),Object(T.jsxs)("div",{className:"info lower-border",children:["Age: ",t.birthDate?B(t.birthDate):this.emptyField]}),Object(T.jsxs)("div",{className:"info lower-border",children:["Gender: ",t.gender?t.gender:this.emptyField]}),Object(T.jsxs)("div",{className:"info lower-border",children:["State: ",this.state.patientState?this.state.patientState:this.emptyField]}),this.renderOtherInfo(),this.renderQRInfo()]}))}},{key:"renderOtherInfo",value:function(){return Object(T.jsxs)("div",{className:"other-info",children:[Object(T.jsx)("div",{className:"lower-border",children:Object(T.jsx)("span",{style:{fontWeight:"bold"},children:"Coding"})}),Object(T.jsxs)("div",{className:"info lower-border",children:["Code: ",this.state.code?this.state.code:this.emptyField]}),Object(T.jsxs)("div",{className:"info lower-border",children:["System:"," ",this.state.codeSystem?I.c[this.state.codeSystem]:this.emptyField]}),Object(T.jsxs)("div",{className:"info lower-border",children:["Display: ",this.state.display?this.state.display:this.emptyField]})]})}},{key:"renderQRInfo",value:function(){var e=this.state.response;return Object(T.jsx)("div",{className:"questionnaire-response",children:e.questionnaire?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:"lower-border",children:Object(T.jsx)("span",{style:{fontWeight:"bold"},children:"In Progress Form"})}),Object(T.jsxs)("div",{className:"info lower-border",children:["Form: ",e.questionnaire?e.questionnaire:this.emptyField]}),Object(T.jsxs)("div",{className:"info lower-border",children:["Author: ",e.author?e.author.reference:this.emptyField]}),Object(T.jsxs)("div",{className:"info lower-border",children:["Date: ",e.authored?e.authored:this.emptyField]})]}):Object(T.jsx)("div",{})})}},{key:"renderPrefetchedResources",value:function(){var e=new Map(Object.entries(this.state.prefetchedResources));if(e.size>0)return this.renderRequestResources(e)}},{key:"renderRequestResources",value:function(e){var t=this,n=new Map;return e.forEach((function(s,a){var r=[];Array.isArray(s)?s.forEach((function(n){console.log("Request resources:"+JSON.stringify(e)),console.log("Request key:"+a),r.push(t.renderResource(n))})):r.push(t.renderResource(s)),n.set(a,r)})),console.log(n),console.log(Object.entries(n)),Object(T.jsxs)("div",{className:"prefetched",children:[Object(T.jsx)("div",{className:"prefetch-header",children:"Prefetched"}),Array.from(n.keys()).map((function(e){var t=n.get(e);return Object(T.jsxs)("div",{children:[Object(T.jsx)("div",{className:"prefetch-subheader",children:e+" Resources"}),t]},e)}))]})}},{key:"renderResource",value:function(e){var t=Object(T.jsx)("div",{children:"N/A"});if(e.id||(e=e.resource),e.id){var n=e.id,s=e.resourceType;t=Object(T.jsxs)("div",{children:[Object(T.jsx)("span",{style:{textTransform:"capitalize"},children:s}),":"," ",s,"/",n," ",".....",Object(T.jsx)("span",{className:"checkmark glyphicon glyphicon-ok"})]},n)}else t=Object(T.jsxs)("div",{children:[Object(T.jsx)("span",{style:{textTransform:"capitalize"},children:"UNKNOWN"})," ",".....",Object(T.jsx)("span",{className:"remove glyphicon glyphicon-remove"})]},"UNKNOWN");return t}},{key:"renderError",value:function(){return Object(T.jsx)("span",{className:"patient-error",children:this.state.patientList.message})}},{key:"buildLaunchLink",value:function(){var e="",t=void 0,n=void 0,s=void 0;this.isOrderNotSelected()||Object.keys(this.state.request).length>0&&(t="".concat(this.state.request.resourceType,"/").concat(this.state.request.id),this.state.request.insurance&&this.state.request.insurance.length>0&&(n="".concat(this.state.request.insurance[0].reference))),t&&(e+="order=".concat(t),n&&(e+="&coverage=".concat(n))),Object.keys(this.state.response).length>0&&(s="QuestionnaireResponse/".concat(this.state.response.id)),t&&s?e+="&response=".concat(s):!t&&s&&(e+="response=".concat(s));var a={appContext:encodeURIComponent(e),type:"smart",url:this.props.launchUrl},r=Object.assign({},a);return Object(A.a)(r,this.props.fhirAccessToken,this.state.patient.id,this.props.fhirServerUrl,this.props.fhirVersion).then((function(e){return r=e}))}},{key:"isOrderNotSelected",value:function(){return 0===Object.keys(this.state.request).length}},{key:"isPatientNotSelected",value:function(){return 0===Object.keys(this.state.patient).length}},{key:"render",value:function(){var e=this,t={};t.serverUrl=this.props.ehrUrl,this.props.access_token&&(t.tokenResponse={access_token:this.props.access_token.access_token});var n=this.isOrderNotSelected()||this.props.loading,s=!this.state.response.questionnaire,a=this.isOrderNotSelected()||this.props.loading,r=this.isPatientNotSelected();return Object(T.jsxs)("div",{children:[Object(T.jsxs)("div",{className:"request",children:[Object(T.jsx)(oe.a,{open:this.state.openPatient,onClose:this.exitSmart,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:Object(T.jsx)(Q.a,{sx:le,children:this.state.patientList instanceof Error?this.renderError():this.state.patientList.map((function(n){return Object(T.jsx)(K,{patient:n,params:t,callback:e.updateStateElement,callbackList:e.updateStateList,callbackMap:e.updateStateMap,updatePrefetchCallback:ne.generateQueries,clearCallback:e.clearState,ehrUrl:e.props.ehrUrl,options:e.state.codeValues,responseExpirationDays:e.props.responseExpirationDays,defaultUser:e.props.defaultUser},n.id)}))})}),Object(T.jsxs)("div",{children:[Object(T.jsx)(j.a,{variant:"contained",onClick:this.getPatients,startIcon:Object(T.jsx)(ie.a,{}),children:"Select a patient"}),Object(T.jsx)("div",{className:"request-header",children:this.state.patient.id?Object(T.jsxs)("span",{children:["Patient ID: ",this.state.patient.id]}):Object(T.jsx)("em",{children:"No patient selected"})}),Object(T.jsxs)("div",{children:[this.renderPatientInfo(),this.renderPrefetchedResources()]})]})]}),this.state.patient.id?Object(T.jsx)("div",{className:"action-btns",children:Object(T.jsxs)(ce.a,{variant:"outlined","aria-label":"outlined button group",children:[Object(T.jsx)(j.a,{onClick:this.relaunch,disabled:s,children:"Open In-Progress Form"}),Object(T.jsx)(j.a,{onClick:this.launchSmartOnFhirApp,disabled:r,children:"Launch SMART on FHIR App"}),Object(T.jsx)(j.a,{onClick:this.sendRx,disabled:a,children:"Send Rx to Pharmacy"}),Object(T.jsx)(j.a,{onClick:this.submit,disabled:n,children:"Sign Order"})]})}):Object(T.jsx)("span",{})]})}}]),n}(s.Component);var ue=n(58),pe=n.n(ue),he=n(23),fe=n.n(he);function be(){for(var e=[],t="---ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<25;n++)e.push(t.charAt(Math.floor(65*Math.random())));return e.join("")}var ge=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var s;return Object(o.a)(this,n),(s=t.call(this,e)).updateStateElement=function(e,t){s.setState(Object(f.a)({},e,t))},s.timeout=function(e){var t=new AbortController;return setTimeout((function(){return t.abort()}),1e3*e),t},s.state={keypair:null,loading:!1,logs:[],patient:{},response:null,showSettings:!1,token:null,alternativeTherapy:fe.a.get("REACT_APP_ALT_DRUG").asBool(),baseUrl:fe.a.get("REACT_APP_EHR_BASE").asString(),cdsUrl:fe.a.get("REACT_APP_CDS_SERVICE").asString(),defaultUser:fe.a.get("REACT_APP_DEFAULT_USER").asString(),ehrUrl:fe.a.get("REACT_APP_EHR_SERVER").asString(),includeConfig:!0,launchUrl:fe.a.get("REACT_APP_LAUNCH_URL").asString(),orderSelect:fe.a.get("REACT_APP_ORDER_SELECT").asString(),orderSign:fe.a.get("REACT_APP_ORDER_SIGN").asString(),patientView:fe.a.get("REACT_APP_PATIENT_VIEW").asString(),pimsUrl:fe.a.get("REACT_APP_PIMS_SERVER").asString(),responseExpirationDays:fe.a.get("REACT_APP_RESPONSE_EXPIRATION_DAYS").asInt(),sendPrefetch:!0,smartAppUrl:fe.a.get("REACT_APP_SMART_LAUNCH_URL").asString()},s.updateStateElement=s.updateStateElement.bind(Object(b.a)(s)),s.submit_info=s.submit_info.bind(Object(b.a)(s)),s.consoleLog=s.consoleLog.bind(Object(b.a)(s)),s.takeSuggestion=s.takeSuggestion.bind(Object(b.a)(s)),s.requestBox=a.a.createRef(),s}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;!function(e){var t=ue.KEYUTIL.generateKeypair("RSA",2048),n=t.prvKeyObj,s=t.pubKeyObj,a=ue.KEYUTIL.getJWKFromKey(n),r=ue.KEYUTIL.getJWKFromKey(s),i=pe.a.jws.JWS.getJWKthumbprint(r),o={private:a,public:r,kid:i},c={pem:r,id:i};fetch("".concat(fe.a.get("REACT_APP_PUBLIC_KEYS").asString(),"/"),{body:JSON.stringify(c),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(t){e(o)})).catch((function(e){console.log(e)}))}((function(t){e.setState({keypair:t})})),function(){var e=fe.a.get("REACT_APP_AUTH").asString()+"/realms/"+fe.a.get("REACT_APP_REALM").asString()+"/protocol/openid-connect/token",t={grant_type:"password",username:fe.a.get("REACT_APP_USER").asString(),password:fe.a.get("REACT_APP_PASSWORD").asString(),client_id:fe.a.get("REACT_APP_CLIENT").asString()},n=Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&");return fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n})}().then((function(e){return e.json()})).then((function(t){e.setState({token:t})})).catch((function(t){e.setState({token:{access_token:""}})}))}},{key:"consoleLog",value:function(e,t){console.log(e);var n={content:e,type:t};this.setState((function(e){return{logs:[].concat(Object(h.a)(e.logs),[n])}}))}},{key:"submit_info",value:function(e,t,n,s){var a=this;this.setState({loading:!0}),this.consoleLog("Initiating form submission",I.d.info),this.setState({patient:n});var r={includeConfig:this.state.includeConfig,alternativeTherapy:this.state.alternativeTherapy},i=function(e,t,n,s,a,r,i,o,c){var l="Practitioner/"+t;e&&(l=e.requester.reference);var d={hookInstance:"d1577c69-dfbe-44ad-ba6d-3e05e953b2ea",fhirServer:s,hook:o,fhirAuthorization:{access_token:a.access_token,token_type:"Bearer",expires_in:300,scope:"patient/Patient.read patient/Observation.read",subject:"cds-service4"},context:{userId:l,patientId:n.id,encounterId:"enc89284"}};if(c.includeConfig){var u={"davinci-crd.configuration":{"alt-drug":c.alternativeTherapy}};d.extension=u}return"order-select"===o?(d.context.draftOrders={resourceType:"Bundle",entry:[{resource:e}]},d.context.selections=[e.resourceType+"/"+e.id]):"order-sign"===o&&(d.context.draftOrders={resourceType:"Bundle",entry:[{resource:e}]}),i&&(d.prefetch={},r.forEach((function(e,t){d.prefetch[t]=e}))),console.log(d),console.log("--------- r4"),d}(t,this.state.defaultUser,n,this.state.ehrUrl,this.state.token,e,this.state.sendPrefetch,s,r),o=this.state.cdsUrl;if("order-sign"===s)o=o+"/"+this.state.orderSign;else if("order-select"===s)o=o+"/"+this.state.orderSelect;else{if("patient-view"!==s)return void this.consoleLog("ERROR: unknown hook type: '",s,"'");o=o+"/"+this.state.patientView}var c=this.state.baseUrl,l="Bearer "+function(e,t,n){console.log("creating jwt");var s=pe.a.jws.IntDate.get("now"),a=pe.a.jws.IntDate.get("now + 1day"),r={alg:"RS256",typ:"JWT",kid:pe.a.jws.JWS.getJWKthumbprint(e.public),jku:fe.a.get("REACT_APP_PUBLIC_KEYS").asString()},i={iss:t,aud:n,iat:s,exp:a,jti:be()};return pe.a.jws.JWS.sign("RS256",JSON.stringify(r),JSON.stringify(i),e.private)}(this.state.keypair,c,o),d=new Headers({"Content-Type":"application/json",authorization:l});try{fetch(o,{method:"POST",headers:d,body:JSON.stringify(i),signal:this.timeout(10).signal}).then((function(e){clearTimeout(a.timeout),e.json().then((function(e){console.log(e),null!==e&&void 0!==e&&e.status?(a.consoleLog("Server returned status "+e.status+": "+e.error,I.d.error),a.consoleLog(e.message,I.d.error)):a.setState({response:e}),a.setState({loading:!1})}))})).catch((function(){a.consoleLog("No response received from the server",I.d.error),a.setState({response:null}),a.setState({loading:!1})}))}catch(u){this.setState({loading:!1}),this.consoleLog("Unexpected error occurred",I.d.error),u instanceof TypeError&&this.consoleLog(u.name+": "+u.message,I.d.error)}}},{key:"takeSuggestion",value:function(e){this.requestBox.current.replaceRequestAndSubmit(e)}},{key:"render",value:function(){var e=this;return Object(T.jsxs)("div",{children:[Object(T.jsx)("div",{className:"nav-header",children:Object(T.jsx)("button",{className:"btn btn-class settings "+(this.state.showSettings?"active":"not-active"),onClick:function(){return e.updateStateElement("showSettings",!e.state.showSettings)},children:Object(T.jsx)("span",{className:"glyphicon glyphicon-cog settings-icon"})})}),Object(T.jsxs)("div",{className:"form-group container left-form",children:[Object(T.jsx)("div",{id:"settings-header"}),this.state.showSettings&&Object(T.jsx)(M,{state:this.state,consoleLog:this.consoleLog,updateCB:this.updateStateElement}),Object(T.jsx)("div",{children:Object(T.jsx)(de,{ehrUrl:this.state.ehrUrl,submitInfo:this.submit_info,access_token:this.state.token,fhirServerUrl:this.state.baseUrl,fhirVersion:"r4",patientId:this.state.patient.id,launchUrl:this.state.launchUrl,responseExpirationDays:this.state.responseExpirationDays,pimsUrl:this.state.pimsUrl,smartAppUrl:this.state.smartAppUrl,defaultUser:this.state.defaultUser,ref:this.requestBox,loading:this.state.loading,consoleLog:this.consoleLog})}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsx)(L,{logs:this.state.logs})]}),Object(T.jsx)("div",{className:"right-form",children:Object(T.jsx)(N,{response:this.state.response,patientId:this.state.patient.id,ehrLaunch:!0,fhirServerUrl:this.state.baseUrl,fhirVersion:"r4",ehrUrl:this.state.ehrUrl,access_token:this.state.token,takeSuggestion:this.takeSuggestion})})]})}}]),n}(s.Component),me=n(210),je=n(222),ve={white:"#fff",offWhite:"#f5f5fa",black:"#222",red:"#d95d77",redDark:"#bb3551",redLight:"#f50057",blue:"#5d89a1",blueDark:"#386883",blueLighter:"#9ad2f0",gray:"#4a4a4a",grayMedium:"#676a70",grayBlue:"#cbd5df",grayBlueDark:"#7d8892",grayHighlight:"#eaeaeb",grayLight:"#4e5258",grayLighter:"#b5b6ba",grayLightest:"#f2f3f9",grayDark:"#444",grayVeryDark:"#3a3a3a",grayLightText:"#87878e",green:"#2fa874",maroon:"#a83048",purple:"#8b72d6",turqoise:"#37c0ae",turqoiseLight:"#e6f7f5"},xe={primary:{main:ve.blue},secondary:{main:ve.redLight},error:{main:ve.red},common:ve,background:{default:ve.grayLightest,primary:ve.grayLight},text:{primary:ve.black,secondary:ve.black,gray:ve.grayLighter},grey:{800:ve.gray},purple:{main:ve.purple}},Oe=Object(je.a)({palette:Object(U.a)({},xe),overrides:Object(U.a)({},{MuiTableCell:{body:{color:"#575b62"},head:{color:"#575b62",fontWeight:"600",fontSize:"12px"},sizeSmall:{padding:"5px 24px 5px 16px","&:last-child":{paddingRight:"0px",width:"80px"}}},MuiTableContainer:{root:{width:"70vw",margin:"0 20px 0 20px",overflowY:"visible",overflowX:"scroll",backgroundColor:"white"}},MuiTableSortLabel:{root:{color:"black","&$active":{color:"black"}}}})}),ye=n(461),Se=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return Object(T.jsx)(u.a,{children:Object(T.jsxs)(p.c,{children:[Object(T.jsx)(p.a,{path:"/",exact:!0,element:Object(T.jsx)(ge,{})}),Object(T.jsx)(p.a,{exact:!0,path:"/patient-portal",element:Object(T.jsx)(ye.a,{theme:Oe,children:Object(T.jsx)(me.a,{})})})]})})}}]),n}(s.Component);i.a.render(Object(T.jsx)(u.a,{basename:"https://mcode.github.io/request-generator",children:Object(T.jsx)(Se,{})}),document.getElementById("root"))},69:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var s=n(78),a=n.n(s);function r(e,t,n,s,r){return new Promise((function(r,i){var o=t?{Accept:"application/json",Authorization:"Bearer ".concat(t.access_token)}:{Accept:"application/json"},c={patient:n};e.appContext&&(c.appContext=e.appContext),a()({method:"post",url:"".concat(s,"/_services/smart/Launch"),headers:o,data:{launchUrl:e.url,parameters:c}}).then((function(t){return t.data&&Object.prototype.hasOwnProperty.call(t.data,"launch_id")?(e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+="launch=".concat(t.data.launch_id),e.url+="&iss=".concat(s),r(e)):(console.error("FHIR server endpoint did not return a launch_id to launch the SMART app. See network calls to the Launch endpoint for more details"),e.error=!0,i(e))})).catch((function(t){return console.error("Cannot grab launch context from the FHIR server endpoint to launch the SMART app. See network calls to the Launch endpoint for more details",t),e.error=!0,i(e)}))}))}}},[[365,1,2]]]);
//# sourceMappingURL=main.1f52789b.chunk.js.map